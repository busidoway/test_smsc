import{_ as J,r as c,a as j,b as D,o,c as l,e as s,F as R,g as B,l as f,p as T,u as g,q as A,t as C,h as $,j as k,s as E,x as z,y as G,z as H,d as K,v as S,A as U,f as P,w as Q,B as W,i as X}from"./app-DSpamfmE.js";const M=h=>(E("data-v-91667aea"),h=h(),z(),h),Y={class:"show modal fade",id:"modalCustomers",style:{display:"block"}},Z={class:"modal-dialog modal-lg"},ss={class:"modal-content"},es={class:"modal-header"},ts=M(()=>s("h5",{class:"modal-title",id:"modalCustomersTitle"},"Выбрать контакты",-1)),os={class:"modal-body"},as={class:"table-responsive text-nowrap"},ls={class:"table"},ns=M(()=>s("thead",null,[s("tr",null,[s("th",null,[s("input",{type:"checkbox",name:"",id:"all_customers",class:"form-check-input"})]),s("th",null,"ID"),s("th",null,"ФИО"),s("th",null,"Телефон"),s("th",null,"Дата рождения")])],-1)),ds={class:"table-border-bottom-0"},cs=["id","value"],us={key:0,class:"spinner-wrap d-flex justify-content-center py-3"},is=M(()=>s("div",{class:"spinner-border",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1)),rs=[is],ms={class:"modal-footer"},_s=M(()=>s("div",{class:"content-backdrop fade"},null,-1)),vs={__name:"ModalCustomers",props:{arrCustomers:Object},emits:["check-items","close-modal"],setup(h,{emit:x}){const w=h,b=x;let r=c([]),m=c([]);const v=c(!0);j(()=>{_()});function _(){let u=[];w.arrCustomers.length!==0&&(u=w.arrCustomers);const d=new FormData,a=JSON.stringify(u);d.append("data",a),D.post("/api/customers",d).then(n=>{v.value=!1,r.value=n.data.customers})}function p(){b("check-items",m),b("close-modal",!0)}return(u,d)=>(o(),l("div",Y,[s("div",Z,[s("form",ss,[s("div",es,[ts,s("button",{type:"button",class:"btn-close",onClick:d[0]||(d[0]=a=>u.$emit("close-modal",!0))})]),s("div",os,[s("div",as,[s("table",ls,[ns,s("tbody",ds,[(o(!0),l(R,null,B(g(r),a=>(o(),l("tr",null,[s("td",null,[f(s("input",{type:"checkbox",name:"",id:"c_id_"+a.id,class:"form-check-input",value:{id:a.id,name:a.name},"onUpdate:modelValue":d[1]||(d[1]=n=>A(m)?m.value=n:m=n)},null,8,cs),[[T,g(m)]])]),s("td",null,C(a.id),1),s("td",null,C(a.name),1),s("td",null,C(a.phone),1),s("td",null,C(a.date),1)]))),256))])]),v.value?(o(),l("div",us,rs)):$("",!0)])]),s("div",ms,[s("button",{type:"button",class:"btn btn-outline-secondary",onClick:d[2]||(d[2]=a=>u.$emit("closeModal",!0))}," Отмена "),s("button",{type:"button",class:"btn btn-primary",onClick:k(p,["prevent"])},"Добавить")])])]),_s]))}},ps=J(vs,[["__scopeId","data-v-91667aea"]]),fs={class:"sendsms-edit"},hs={class:"py-3 mb-4 d-flex align-items-center"},bs={key:0,class:"m-0"},ys={key:1,class:"m-0"},ks={key:2,class:"badge bg-label-success mt-2 ms-3"},gs={key:3,class:"badge bg-label-danger mt-2 ms-3"},Cs={key:4,class:"ms-3"},xs={class:"card"},$s={class:"card-body"},ws={action:"",method:"post"},Ss={class:"mb-3"},Ds=s("label",{for:"name_sendsms",class:"form-label"},"Название",-1),Ms={class:"mb-5"},Vs=s("label",{for:"text_sendsms",class:"form-label"},"Текст",-1),Is={class:"mb-5"},Ns=s("h5",null,"Список получателей",-1),Us={class:"mb-3"},js={class:"mb-2"},Rs=["id","value"],Bs=["for"],Fs={class:""},Ls=s("i",{class:"bx bxs-user-plus"},null,-1),Os=s("span",{class:"ms-1"},"Добавить контакты",-1),qs=[Ls,Os],Js={class:"mb-5"},Ts=s("h5",null,"Запустите рассылку",-1),As={class:"mb-3"},Es=s("label",{for:"r_send_now",class:"ms-2 form-check-label"},"Отправить сейчас",-1),zs={class:"mb-3 d-flex align-items-center"},Gs={class:""},Hs=s("label",{for:"r_send_regular",class:"ms-2 form-check-label"},"Регулярно",-1),Ks={class:"d-flex ms-5"},Ps=s("select",{name:"frequency",id:"frequency",class:"form-select form-select-sm"},[s("option",{value:"daily",selected:""},"Ежедневно")],-1),Qs=s("span",{class:"ms-3"},"в",-1),Ws=s("select",{name:"template",id:"template",class:"form-select form-select-sm ms-3"},[s("option",{value:"1",selected:""},"За N дней до дня рождения")],-1),Xs=s("span",{class:"ms-3 d-inline me-2"},"дней:",-1),Ys={class:"form-check form-switch mb-4"},Zs=s("label",{class:"form-check-label",for:"activeSendSms"},"Запуск отправки SMS",-1),se={class:"mb-3 d-flex align-items-center"},ee={key:0},te={key:1},ae={__name:"SendsmsEdit",setup(h){const x=G(),w=H(),b=c(!1);let r=c([]);const m=c(""),v=c(""),_=c(""),p=c("00:00"),u=c(0),d=c(!1),a=c(!1),n=c({success:!1,error:!1,info:""});j(()=>{_.value="now",q(x.params.id)});function F(){return b.value=!0}function L(){return b.value=!1}function O(i){i.value&&(r=i.value)}function V(){let i=[];r.value||(i=r);const e=new FormData,y=JSON.stringify({name:m.value,message:v.value,time:p.value,customers:i,type:_.value,count_days:u.value,active_send:a.value});e.append("data",y),D.post("/api/sendsms_store",e).then(t=>{t.data.status==="success"?(n.value.error=!1,n.value.success=!0,w.push("/sendsms/edit/"+t.data.sendsms.id)):t.data.status==="error"&&(n.value.success=!1,n.value.error=!0)})}function q(i){i&&D.get("/api/sendsms_edit/"+i).then(e=>{e.data.sendsms.length!==0&&(m.value=e.data.sendsms.name,v.value=e.data.sendsms.message,p.value=e.data.sendsms.time,u.value=e.data.sendsms.count_days,p.value&&u.value&&(_.value="reg"),d.value=!0),e.data.customers.length!==0&&(r.value=e.data.customers)})}function I(i){if(i){let e=[];r.value||(e=r);const y=new FormData,t=JSON.stringify({name:m.value,message:v.value,time:p.value,customers:e,type:_.value,count_days:u.value,active_send:a.value});y.append("data",t),D.post("/api/sendsms_update/"+i,y).then(N=>{N.data.status==="success"?(n.value.error=!1,n.value.success=!0):N.data.status==="error"&&(n.value.success=!1,n.value.error=!0)})}}return(i,e)=>{const y=K("RouterLink");return o(),l("div",fs,[s("div",hs,[d.value?(o(),l("h4",bs,"Редактирование")):(o(),l("h4",ys,"Создать рассылку")),n.value.success?(o(),l("div",ks,"Успешно сохранено")):$("",!0),n.value.error?(o(),l("div",gs,"Ошибка")):$("",!0),n.value.info?(o(),l("div",Cs,": "+C(n.value.info),1)):$("",!0)]),s("div",xs,[s("div",$s,[s("form",ws,[s("div",Ss,[Ds,f(s("input",{type:"text",name:"name",id:"name_sendsms",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=t=>m.value=t)},null,512),[[S,m.value]])]),s("div",Ms,[Vs,f(s("textarea",{type:"text",name:"message",id:"mess_sendsms",class:"form-control",rows:"10","onUpdate:modelValue":e[1]||(e[1]=t=>v.value=t)},null,512),[[S,v.value]])]),s("div",Is,[Ns,s("div",Us,[(o(!0),l(R,null,B(g(r),t=>(o(),l("div",js,[s("input",{type:"checkbox",name:"",class:"form-check-input",id:"customer_"+t.id,value:t.id},null,8,Rs),s("label",{for:"customer_"+t.id,class:"ms-2 form-check-label"},C(t.name),9,Bs)]))),256))]),s("div",Fs,[s("button",{type:"button",class:"btn btn-outline-primary btn-add-customer",onClick:k(F,["prevent"])},qs)])]),s("div",Js,[Ts,s("div",As,[f(s("input",{type:"radio",name:"type_sendsms",class:"form-check-input",id:"r_send_now",value:"now","onUpdate:modelValue":e[2]||(e[2]=t=>_.value=t)},null,512),[[U,_.value]]),Es]),s("div",zs,[s("div",Gs,[f(s("input",{type:"radio",name:"type_sendsms",class:"form-check-input",id:"r_send_regular",value:"reg","onUpdate:modelValue":e[3]||(e[3]=t=>_.value=t)},null,512),[[U,_.value]]),Hs]),s("div",Ks,[Ps,Qs,f(s("input",{class:"form-control form-control-sm ms-3",type:"time",value:"10:30:00","onUpdate:modelValue":e[4]||(e[4]=t=>p.value=t),id:"html5-time-input"},null,512),[[S,p.value]]),Ws,Xs,f(s("input",{type:"number","onUpdate:modelValue":e[5]||(e[5]=t=>u.value=t),class:"form-control form-control-sm",min:"0",value:"0",style:{width:"60px"}},null,512),[[S,u.value]])])])]),s("div",Ys,[s("input",{class:"form-check-input",type:"checkbox",id:"activeSendSms",onChange:e[6]||(e[6]=t=>a.value=!a.value)},null,32),Zs]),s("div",se,[d.value?(o(),l("div",ee,[a.value?(o(),l("button",{key:0,class:"btn rounded-pill btn-success",onClick:e[7]||(e[7]=k(t=>I(g(x).params.id),["prevent"]))},"Сохранить и отправить")):(o(),l("button",{key:1,class:"btn rounded-pill btn-primary",onClick:e[8]||(e[8]=k(t=>I(g(x).params.id),["prevent"]))},"Сохранить"))])):(o(),l("div",te,[a.value?(o(),l("button",{key:0,class:"btn rounded-pill btn-success",onClick:k(V,["prevent"])},"Сохранить и отправить")):(o(),l("button",{key:1,class:"btn rounded-pill btn-primary",onClick:k(V,["prevent"])},"Сохранить"))])),P(y,{to:"/sendsms",class:"btn rounded-pill btn-outline-secondary ms-4"},{default:Q(()=>[X("Назад")]),_:1})])])])]),b.value?(o(),W(ps,{key:0,onCloseModal:L,onCheckItems:O,"arr-customers":g(r)},null,8,["arr-customers"])):$("",!0)])}}};export{ae as default};
